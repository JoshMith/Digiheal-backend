generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  password  String
  role      UserRole
  isActive  Boolean   @default(true)
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  patient   Patient?
  staff     Staff?
}

model Patient {
  id                    String         @id @default(uuid())
  userId                String         @unique
  studentId             String         @unique
  firstName             String
  lastName              String
  dateOfBirth           DateTime
  gender                Gender
  phone                 String
  bloodGroup            String?
  allergies             String[]
  chronicConditions     String[]
  emergencyContactName  String?
  emergencyContactPhone String?
  createdAt             DateTime       @default(now())
  appointments          Appointment[]
  interactions          Interaction[]
  notifications         Notification[]
  user                  User           @relation(fields: [userId], references: [id])
  prescriptions         Prescription[]
  vitalSigns            VitalSigns[]
}

model Staff {
  id             String         @id @default(uuid())
  userId         String         @unique
  staffId        String         @unique
  firstName      String
  lastName       String
  department     Department
  position       StaffPosition
  specialization String?
  licenseNumber  String?
  phone          String
  isAvailable    Boolean        @default(true)
  createdAt      DateTime       @default(now())
  appointments   Appointment[]
  interactions   Interaction[]
  prescriptions  Prescription[]
  user           User           @relation(fields: [userId], references: [id])
}

model Appointment {
  id              String            @id @default(uuid())
  patientId       String
  staffId         String?
  appointmentDate DateTime
  appointmentTime String
  duration        Int               @default(30)
  department      Department
  type            AppointmentType
  status          AppointmentStatus
  priority        PriorityLevel
  queueNumber     Int?
  reason          String?
  notes           String?
  checkedInAt     DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  cancelledAt     DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  patient         Patient           @relation(fields: [patientId], references: [id])
  staff           Staff?            @relation(fields: [staffId], references: [id])
  interaction     Interaction?
  prescriptions   Prescription[]
}

model Prescription {
  id             String             @id @default(uuid())
  patientId      String
  staffId        String
  appointmentId  String?
  medicationName String
  dosage         String
  frequency      String
  duration       String
  quantity       Int?
  instructions   String?
  status         PrescriptionStatus
  prescribedAt   DateTime           @default(now())
  expiresAt      DateTime?
  dispensedAt    DateTime?
  createdAt      DateTime           @default(now())
  appointment    Appointment?       @relation(fields: [appointmentId], references: [id])
  patient        Patient            @relation(fields: [patientId], references: [id])
  staff          Staff              @relation(fields: [staffId], references: [id])
}

model Interaction {
  id                   String          @id @default(uuid())
  appointmentId        String          @unique
  patientId            String
  staffId              String
  department           Department
  priority             PriorityLevel
  appointmentType      AppointmentType
  symptomCount         Int             @default(0)
  checkInTime          DateTime
  vitalsStartTime      DateTime?
  vitalsEndTime        DateTime?
  interactionStartTime DateTime?
  interactionEndTime   DateTime?
  checkoutTime         DateTime?
  vitalsDuration       Int?
  interactionDuration  Int?
  totalDuration        Int?
  predictedDuration    Int?
  createdAt            DateTime        @default(now())
  appointment          Appointment     @relation(fields: [appointmentId], references: [id])
  patient              Patient         @relation(fields: [patientId], references: [id])
  staff                Staff           @relation(fields: [staffId], references: [id])
}

model VitalSigns {
  id                     String   @id @default(uuid())
  patientId              String
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  heartRate              Int?
  temperature            Float?
  weight                 Float?
  height                 Float?
  oxygenSaturation       Int?
  respiratoryRate        Int?
  recordedAt             DateTime @default(now())
  patient                Patient  @relation(fields: [patientId], references: [id])
}

model Notification {
  id        String           @id @default(uuid())
  patientId String
  type      NotificationType
  title     String
  message   String
  priority  PriorityLevel
  read      Boolean          @default(false)
  readAt    DateTime?
  createdAt DateTime         @default(now())
  patient   Patient          @relation(fields: [patientId], references: [id])
}

enum UserRole {
  PATIENT
  STAFF
  ADMIN
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Department {
  GENERAL_MEDICINE
  EMERGENCY
  PEDIATRICS
  MENTAL_HEALTH
  DENTAL
  PHARMACY
  LABORATORY
}

enum StaffPosition {
  DOCTOR
  NURSE
  PHARMACIST
  LAB_TECHNICIAN
  ADMINISTRATOR
  RECEPTIONIST
}

enum AppointmentType {
  WALK_IN
  SCHEDULED
  FOLLOW_UP
  EMERGENCY
  ROUTINE_CHECKUP
}

enum AppointmentStatus {
  SCHEDULED
  CHECKED_IN
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum PriorityLevel {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum PrescriptionStatus {
  ACTIVE
  DISPENSED
  COMPLETED
  CANCELLED
  EXPIRED
}

enum NotificationType {
  APPOINTMENT_REMINDER
  PRESCRIPTION_READY
  MEDICATION_REMINDER
  SYSTEM_ANNOUNCEMENT
}
